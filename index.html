<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0d10" />
  <title>BWK-Stundenplan</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="topbar no-print">
    <button class="icon-btn" id="btnToggleSidebar" aria-label="Seitenleiste √∂ffnen/schlie√üen">‚ò∞</button>

    <div class="brand">
      <div class="brand-title">BWK-Stundenplan</div>
    </div>

    <div class="top-actions">
      <div class="controls" aria-label="Woche ausw√§hlen">
        <button class="icon-btn" id="btnPrevWeek" title="Vorherige Woche" aria-label="Vorherige Woche">‚óÄ</button>

        <input class="ctrl small" id="yearInput" type="number" inputmode="numeric" min="2026" max="2099" step="1" aria-label="Jahr" />
        <select class="ctrl small" id="weekSelect" aria-label="Kalenderwoche"></select>

        <div class="week-range" id="weekRangeLabel">‚Äî</div>

        <button class="icon-btn" id="btnNextWeek" title="N√§chste Woche" aria-label="N√§chste Woche">‚ñ∂</button>

        <button class="btn ghost" id="btnToday" title="Zur aktuellen Woche springen">Heute</button>
      </div>

      <button class="icon-btn" id="btnToggleHolidayPane" aria-label="Ferienbereich ein/ausblenden" title="Ferien ein/ausblenden">üóìÔ∏è</button>

      <button class="btn" id="btnPrint">üñ®Ô∏è Drucken</button>

      <button class="icon-btn" id="btnHelp" aria-label="Hilfe" title="Hilfe">?</button>
      <button class="icon-btn" id="btnReload" aria-label="App neu laden" title="App neu laden">‚ü≥</button>

      <button class="icon-btn" id="btnSaveNow" aria-label="Jetzt lokal speichern" title="Jetzt lokal speichern">üíæ</button>
      <button class="icon-btn" id="btnExport" aria-label="Backup exportieren" title="Backup exportieren">‚¨áÔ∏è</button>

      <input id="importFile" type="file" accept="application/json" hidden />
      <button class="icon-btn" id="btnImport" aria-label="Backup importieren" title="Backup importieren">‚¨ÜÔ∏è</button>
    </div>
  </header>

  <div class="shell">
    <aside class="sidebar no-print" id="sidebar">
      <div class="sidebar-head">
        <div class="sidebar-title">Module</div>
        <button class="icon-btn" id="btnSettings" aria-label="Einstellungen" title="Einstellungen">‚öôÔ∏è</button>
      </div>

      <div class="hint" id="placeHint">Fach/Sondermodul antippen ‚Äì anschlie√üend ein Feld im Plan. Oder das Fach direkt in das Wunschfeld ziehen.</div>

      <details class="section" open>
        <summary class="section-title">
          Lehrkr√§fte
          <span class="summary-actions">
            <span class="count" id="countTeachers">0</span>
            <button class="icon-btn tiny" id="btnAddTeacher" type="button" aria-label="Lehrkraft hinzuf√ºgen" title="Lehrkraft hinzuf√ºgen">Ôºã</button>
          </span>
        </summary>
        <div class="list" id="teacherList"></div>
      </details>

      <details class="section" open>
        <summary class="section-title">
          F√§cher
          <span class="summary-actions">
            <span class="count" id="countSubjects">0</span>
            <button class="icon-btn tiny" id="btnAddSubject" type="button" aria-label="Fach hinzuf√ºgen" title="Fach hinzuf√ºgen">Ôºã</button>
          </span>
        </summary>
        <div class="list" id="subjectList"></div>
      </details>

      <details class="section">
        <summary class="section-title">
          Sonderveranstaltungen
          <span class="summary-actions">
            <span class="count" id="countSpecials">0</span>
            <button class="icon-btn tiny" id="btnAddSpecial" type="button" aria-label="Sonderveranstaltung hinzuf√ºgen" title="Sonderveranstaltung hinzuf√ºgen">Ôºã</button>
          </span>
        </summary>
        <div class="list" id="specialList"></div>
      </details>

      <div class="sidebar-foot">
        <div class="small" id="saveInfo">‚Äî</div>
        <div class="small" id="appInfo">‚Äî</div>
      </div>
    </aside>

    <main class="content">
      <section class="grid">
        <div class="card">
          <div class="card-head">
            <div class="card-title">Stundenplan</div>
            <div class="controls no-print">
              <button class="btn ghost" id="btnClearWeek">Woche leeren</button>
            </div>
          </div>

          <div class="print-area" id="printArea">
            <div class="print-inner" id="printInner">
              <div class="plan-meta">
                <div>
                  <div class="title" id="planTitle">‚Äî</div>
                  <div class="sub" id="planSub">‚Äî</div>
                </div>
                <div class="sub" id="planState">‚Äî</div>
              </div>

              <div class="timetable" id="timetable"></div>

              <div class="legend" id="legend"></div>

              <div class="week-notes" id="weekNotesWrap">
                <div class="week-notes-title">Freitext (optional)</div>
                <textarea id="weekNotesInput" class="week-notes-input" rows="3" maxlength="800" placeholder="z. B. Hinweise, Absprachen, Besonderheiten der Woche ‚Ä¶"></textarea>
                <div id="weekNotesPrint" class="week-notes-print only-print"></div>
              </div>

              <div class="hint no-print">Klick auf ein Feld = bearbeiten. Doppelklick = leeren.</div>
            </div>
          </div>
        </div>

        <div class="card no-print holiday-card" id="holidayCard">
          <div class="card-head">
            <div class="card-title">Ferien</div>
            <div class="holiday-head-right">
              <div class="seg" role="group" aria-label="Ferien-Referenz">
                <button class="seg-btn" id="btnStateBE" type="button" data-state="BE">BER</button>
                <button class="seg-btn" id="btnStateBB" type="button" data-state="BB">BRB</button>
              </div>
              <div class="chip" id="holidayStatus">‚Äî</div>
              <button class="icon-btn tiny" id="btnToggleHolidays" type="button" aria-label="Ferien einklappen/ausklappen" title="Ferien einklappen/ausklappen">‚ñæ</button>
            </div>
          </div>

          <div class="section" id="holidayBody">
            <div class="hint">Nur Orientierung ‚Äì beeinflusst den Plan nicht automatisch.</div>
            <div class="list" id="holidayList"></div>
            <div class="hint" id="holidayHint"></div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Help Modal -->
  <dialog class="modal" id="helpDialog">
    <form method="dialog" class="modal-box">
      <div class="modal-title">Kurzanleitung</div>
      <div class="hint" style="margin-top:10px">
        <ul class="help-list">
          <li><b>Module anlegen:</b> Lehrkr√§fte, F√§cher (mit Farbe) und Sonderveranstaltungen links √ºber <b>Ôºã</b>.</li>
          <li><b>Schnell einf√ºgen:</b> Fach/Sonder antippen ‚Üí dann ein Feld im Plan antippen. <b>Esc</b> bricht ab.</li>
          <li><b>Desktop:</b> Module per Drag&Drop in ein Feld ziehen.</li>
          <li><b>Bearbeiten:</b> Klick aufs Feld √∂ffnet den Editor. Doppelklick setzt sofort <b>leer</b>.</li>
          <li><b>Ganzer Tag:</b> Im Editor zus√§tzliche Stundenbl√∂cke √ºber Checkbox ausw√§hlen ‚Üí Speichern.</li>
          <li><b>Freitext:</b> Notizen / Anmerkungen werden mitgedruckt, wenn vorhanden.</li>
          <li><b>Export/Import:</b> Backup als JSON sichern oder wieder einlesen.</li>
          <li><b>Ferien:</b> Nur BER/BRB als grobe Referenz, ohne Einfluss auf den Plan.</li>
          <li><b>Feiertage (BER):</b> Gesetzliche Feiertage werden markiert ‚Äì Planung ist an diesen Tagen gesperrt.</li>
        </ul>
      </div>
      <div class="modal-actions">
        <button class="btn" value="ok">OK</button>
      </div>
    </form>
  </dialog>

  <!-- Teacher Modal -->
  <dialog class="modal" id="teacherDialog">
    <form method="dialog" class="modal-box" id="teacherForm">
      <div class="modal-title" id="teacherDialogTitle">Lehrkraft hinzuf√ºgen</div>

      <label class="field">
        <span>Name</span>
        <input id="teacherName" type="text" required minlength="1" maxlength="60" placeholder="z. B. Frau M√ºller" />
      </label>

      <label class="field">
        <span>K√ºrzel (optional)</span>
        <input id="teacherShort" type="text" maxlength="12" placeholder="z. B. M√úL" />
      </label>

      <div class="modal-actions">
        <button class="btn ghost" type="button" data-cancel>Abbrechen</button>
        <button class="btn danger" id="teacherDeleteBtn" type="button">L√∂schen</button>
        <button class="btn" id="teacherSubmit" value="ok">Speichern</button>
      </div>

      <input type="hidden" id="teacherEditId" />
    </form>
  </dialog>

  <!-- Subject Modal -->
  <dialog class="modal" id="subjectDialog">
    <form method="dialog" class="modal-box" id="subjectForm">
      <div class="modal-title" id="subjectDialogTitle">Fach hinzuf√ºgen</div>

      <label class="field">
        <span>Fach</span>
        <input id="subjectName" type="text" required minlength="1" maxlength="60" placeholder="z. B. Mathe" />
      </label>

      <div class="row">
        <label class="field">
          <span>Farbe</span>
          <input id="subjectColor" type="color" value="#6aa6ff" />
        </label>
        <label class="field">
          <span>Standard-Lehrkraft (optional)</span>
          <select id="subjectDefaultTeacher"></select>
        </label>
      </div>

      <div class="modal-actions">
        <button class="btn ghost" type="button" data-cancel>Abbrechen</button>
        <button class="btn danger" id="subjectDeleteBtn" type="button">L√∂schen</button>
        <button class="btn" id="subjectSubmit" value="ok">Speichern</button>
      </div>

      <input type="hidden" id="subjectEditId" />
    </form>
  </dialog>

  <!-- Special Modal -->
  <dialog class="modal" id="specialDialog">
    <form method="dialog" class="modal-box" id="specialForm">
      <div class="modal-title" id="specialDialogTitle">Sonderveranstaltung hinzuf√ºgen</div>

      <label class="field">
        <span>Titel</span>
        <input id="specialTitle" type="text" required minlength="1" maxlength="80" placeholder="z. B. Exkursion, Pr√ºfung, Workshop" />
      </label>

      <label class="field">
        <span>Farbe</span>
        <input id="specialColor" type="color" value="#ffb86b" />
      </label>

      <div class="modal-actions">
        <button class="btn ghost" type="button" data-cancel>Abbrechen</button>
        <button class="btn danger" id="specialDeleteBtn" type="button">L√∂schen</button>
        <button class="btn" id="specialSubmit" value="ok">Speichern</button>
      </div>

      <input type="hidden" id="specialEditId" />
    </form>
  </dialog>

  <!-- Entry Modal (cell editor) -->
  <dialog class="modal" id="entryDialog">
    <form method="dialog" class="modal-box" id="entryForm">
      <div class="modal-title" id="entryDialogTitle">Eintrag</div>

      <div class="row">
        <label class="field">
          <span>Typ</span>
          <select id="entryType">
            <option value="empty">Leer</option>
            <option value="subject">Fach</option>
            <option value="special">Sonder</option>
          </select>
        </label>

        <label class="field" id="entrySubjectWrap">
          <span>Fach</span>
          <select id="entrySubject"></select>
        </label>
      </div>

      <div class="row" id="entryTeacherRow">
        <label class="field">
          <span>Lehrkraft (optional)</span>
          <select id="entryTeacher"></select>
        </label>
        <label class="field" id="entrySpecialWrap">
          <span>Sonder</span>
          <select id="entrySpecial"></select>
        </label>
      </div>

      <div class="row">
        <label class="field">
          <span>Raum (optional)</span>
          <input id="entryRoom" type="text" maxlength="40" placeholder="z. B. R. 210" />
        </label>
        <label class="field">
          <span>Notiz (optional)</span>
          <input id="entryNote" type="text" maxlength="80" placeholder="z. B. Vertretung, Thema, ‚Ä¶" />
        </label>
      </div>

      <div class="apply-wrap" id="applyWrap">
        <div class="apply-title">Auf weitere Bl√∂cke anwenden (gleicher Tag)</div>
        <div class="apply-grid" id="applyGrid" aria-label="Bl√∂cke ausw√§hlen"></div>
      </div>

      <div class="modal-actions">
        <button class="btn ghost" type="button" data-cancel>Abbrechen</button>
        <button class="btn danger" id="entryDeleteBtn" type="button">L√∂schen</button>
        <button class="btn" id="entrySubmit" value="ok">Speichern</button>
      </div>

      <input type="hidden" id="entryCellKey" />
    </form>
  </dialog>

  <!-- Settings Modal -->
  <dialog class="modal" id="settingsDialog">
    <form method="dialog" class="modal-box" id="settingsForm">
      <div class="modal-title">Einstellungen</div>

      <div class="hint">Block-Beschriftungen (4 Doppelbl√∂cke). Es k√∂nnen auch Unterrichtszeiten eingetragen werden.</div>

      <div class="row">
        <label class="field">
          <span>Block 1</span>
          <input id="slot1" type="text" maxlength="40" placeholder="z. B. 08:30‚Äì10:00" />
        </label>
        <label class="field">
          <span>Block 2</span>
          <input id="slot2" type="text" maxlength="40" placeholder="z. B. 10:15‚Äì11:45" />
        </label>
      </div>

      <div class="row">
        <label class="field">
          <span>Block 3</span>
          <input id="slot3" type="text" maxlength="40" placeholder="z. B. 12:30‚Äì14:00" />
        </label>
        <label class="field">
          <span>Block 4</span>
          <input id="slot4" type="text" maxlength="40" placeholder="z. B. 14:15‚Äì15:45" />
        </label>
      </div>

      <div class="row">
        <label class="field">
          <span>Akzentfarbe</span>
          <select id="accentSelect" aria-label="Akzentfarbe w√§hlen">
            <option value="blue">Blau</option>
            <option value="green">Gr√ºn</option>
            <option value="wine">Weinrot</option>
            <option value="violet">Violett</option>
            <option value="brown">Braun</option>
            <option value="mustard">Senfgelb</option>
          </select>
        </label>
        <div class="field">
          <span>Hinweis</span>
          <div class="hint" style="margin-top:0">Der Akzent beeinflusst Hintergrund und Fenster (nicht die Fachfarben).</div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn ghost" type="button" data-cancel>Abbrechen</button>
        <button class="btn" id="settingsSubmit" value="ok">Speichern</button>
      </div>
    </form>
  </dialog>

  <!-- Import Modal -->
  <dialog class="modal" id="importDialog">
    <div class="modal-box">
      <div class="modal-title">Import</div>
      <div class="hint">
        Die importierten Daten k√∂nnen entweder <b>ersetzt</b> (empfohlen nach Cookie-/Browserdaten-L√∂schung),
        oder <b>zusammenf√ºhrt</b> werden.
      </div>

      <div class="modal-actions">
        <button class="btn ghost" id="importCancel">Abbrechen</button>
        <button class="btn" id="importMerge">Zusammenf√ºhren</button>
        <button class="btn danger" id="importReplace">Ersetzen</button>
      </div>
    </div>
  </dialog>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script src="script.js"></script>
</body>
</html>
